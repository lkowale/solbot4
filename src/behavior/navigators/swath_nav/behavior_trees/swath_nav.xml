<!--
  Swath Navigation Behavior Tree

  Navigates through a series of WGS84 geo points with pause/resume support.

  Blackboard variables:
    Input (set by navigator):
      - geo_points: vector of GeoPoint
      - planner_id: string (planner plugin to use)
      - controller_id: string (controller plugin to use)
      - path_pub_topic: string (topic to publish path)


-->
<root BTCPP_format="4" main_tree_to_execute="SwathNav">
  <BehaviorTree ID="SwathNav">
    <Sequence>
      <!-- Convert WGS84 coordinates to map frame using robot_localization/fromLL -->
      <ConvertGeoPoints geo_points="{geo_points}" map_points="{map_points}"/>
      <GetPoseFromPoses poses="{map_points}" pose="{start_pose}" index="0" />
      <ComputePathToPose goal="{start_pose}" path="{path_to_start}" planner_id="{planner_id}" error_code_id="{compute_path_error_code}"/>
      <PublishPath topic_name="/to_start_path" path="{path_to_start}"/>
      <FollowPath path="{path_to_start}" controller_id="FollowPath" error_code_id="{follow_path_error_code}"/> 
      <!-- Compute swath path -->
      <ComputePathToPose goal="{end_pose}" path="{main_path}" start="{start_pose}" planner_id="StraightLine" error_code_id="{compute_path_error_code}"/>
      <!-- Compute path through all waypoints -->
      <ComputePathThroughPoses goals="{map_points}" path="{swath_path}" planner_id="{planner_id}" error_code_id="{compute_path_error_code}"/>
      <PublishPath topic_name="{path_pub_topic}" path="{swath_path}"/>
      <!-- Follow the computed path -->
      <FollowPath path="{swath_path}" controller_id="{controller_id}" error_code_id="{follow_path_error_code}"/>

    </Sequence>
  </BehaviorTree>
</root>
